# Signup Wizard

サービス申込ウィザード - 条件分岐を含む複数ステップのフォーム。

## このサンプルが示すSBPの強み

**Figmaでは表現しにくいが、SBPなら明確に書ける**ポイント：

| ポイント | Figmaの限界 | SBPでの表現 |
|----------|-------------|-------------|
| 条件分岐による画面遷移 | 静的なカンプでは表現困難 | `when: accountType is "corporate"` |
| 動的なフィールド出し分け | 別カンプが必要 | `when: paymentMethod is "credit_card"` |
| 条件付きバリデーション | 仕様書に別途記載 | `when: ... rule: required` |
| ステップスキップ | フロー図を別途作成 | `when: plan is "free" then: navigate(Step5)` |
| 確認画面からの編集 | 遷移図が複雑化 | `editAction: actions.editStep2` |

## 画面フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    Step1: アカウント種別選択                      │
│                      [個人] / [法人]                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
              ┌─────────────┴─────────────┐
              │                           │
              ▼                           ▼
┌─────────────────────┐       ┌─────────────────────┐
│  Step2-Personal     │       │  Step2-Corporate    │
│  ・氏名             │       │  ・法人名           │
│  ・メールアドレス    │       │  ・担当者名         │
│  ・パスワード        │       │  ・メールアドレス    │
│  ・電話番号（任意）   │       │  ・パスワード        │
└──────────┬──────────┘       └──────────┬──────────┘
           │                              │
           └──────────────┬───────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                       Step3: プラン選択                          │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐               │
│  │ フリー   │ │スターター│ │  プロ   │ │エンター │               │
│  │  ¥0    │ │  ¥980  │ │ ¥2,980 │ │ ¥9,800 │               │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘               │
│  ※ 個人: フリー〜プロ / 法人: プロ〜エンタープライズ              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
              ┌─────────────┴─────────────┐
              │                           │
              │ 有料プラン                │ 無料プラン
              ▼                           │
┌─────────────────────┐                   │
│  Step4: 支払い情報   │                   │
│  ・支払い方法        │                   │
│  ・カード情報        │ ←条件表示         │
│  ・請求先            │                   │
└──────────┬──────────┘                   │
           │                              │
           └──────────────┬───────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Step5: 確認画面                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ アカウント情報                              [編集]       │   │
│  │ 種別: 法人                                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 法人情報                                    [編集]       │   │
│  │ 法人名: 株式会社○○ / 担当者: 田中太郎                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ プラン                                      [編集]       │   │
│  │ エンタープライズ ¥9,800/月                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ☐ 利用規約に同意する                                         │
│                                              [申し込む]        │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Step6: 完了画面                             │
│                         ✓                                       │
│              お申し込みありがとうございます                       │
│                                                                 │
│              確認メールをお送りしました                           │
│                                                                 │
│                    [ログイン画面へ]                              │
└─────────────────────────────────────────────────────────────────┘
```

## SBPで表現している主要なロジック

### 1. 条件分岐による画面遷移

```yaml
# Step1 → Step2: アカウント種別で分岐
actions:
  goToStep2:
    steps:
      - when: $globals.wizardData.accountType is "personal"
        then:
          - navigate: Step2Personal
        else:
          - navigate: Step2Corporate
```

### 2. プラン選択肢の動的フィルタリング

```yaml
computed:
  # アカウント種別によって選べるプランが変わる
  availablePlans:
    expr: |
      $constants.plans filtered by
        $globals.wizardData.accountType in item.availableFor
```

### 3. 支払い方法による入力フィールドの出し分け

```yaml
# クレジットカード選択時のみカード情報入力欄を表示
- when: $form.values.paymentMethod is "credit_card"
  then:
    - TextField:
        label: カード番号
        ...
```

### 4. 条件付きバリデーション

```yaml
validation:
  cardNumber:
    # クレジットカード払いの場合のみ必須
    - when: $form.values.paymentMethod is "credit_card"
      rule: required
      message: カード番号は必須です
```

### 5. 無料プランの場合のステップスキップ

```yaml
actions:
  proceed:
    steps:
      - when: $selectedPlan.price equals 0
        then:
          # 支払い情報入力をスキップして確認画面へ
          - navigate: Step5Confirm
        else:
          - navigate: Step4Payment
```

### 6. 確認画面からの各ステップ編集

```yaml
- ConfirmSection:
    title: 法人情報
    editAction: actions.editStep2  # ← クリックでStep2に戻る
    items:
      - label: 法人名
        value: $globals.wizardData.companyName
```

### 7. 途中離脱時の確認ダイアログ

```yaml
guards:
  - on: browserBack
    when: $globals.currentStep > 1 and $globals.currentStep < 6
    confirm:
      title: 入力を破棄しますか？
      message: 入力した内容は保存されません。
```

## 画面一覧

| 画面 | ルート | 説明 |
|------|--------|------|
| Step1AccountType | `/signup/step1` | アカウント種別選択 |
| Step2Personal | `/signup/step2/personal` | 個人情報入力 |
| Step2Corporate | `/signup/step2/corporate` | 法人情報入力 |
| Step3Plan | `/signup/step3` | プラン選択 |
| Step4Payment | `/signup/step4` | 支払い情報入力（有料のみ） |
| Step5Confirm | `/signup/step5` | 入力内容確認 |
| Step6Complete | `/signup/complete` | 申し込み完了 |

## 状態管理

ウィザード全体のデータは `globals.wizardData` で管理し、`sessionStorage` に永続化：

```yaml
globals:
  wizardData:
    type: WizardData
    persist: sessionStorage

  currentStep:
    type: number
    initial: 1
```

これにより：
- ブラウザを閉じても入力途中のデータが残る
- 各ステップ間でデータを共有できる
- 確認画面から編集に戻っても入力内容が保持される

## Figmaとの比較

このウィザードをFigmaだけで設計しようとすると：

1. **6画面 × 条件分岐 = 10+枚のカンプ**が必要
2. **フロー図を別途作成**して遷移条件を説明
3. **仕様書に詳細なバリデーションルール**を記載
4. デザイナー→エンジニア間で**解釈のズレ**が発生しやすい

SBPなら：
- **1ファイルで構造・状態・遷移・バリデーションを一元管理**
- AIがそのまま解釈してコード生成可能
- レビュアーが設計意図を正確に把握できる
