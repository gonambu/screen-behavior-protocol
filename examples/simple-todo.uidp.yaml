# ============================================================
# Simple ToDo App - UIDP サンプル
# ============================================================
# シンプルなToDoリストアプリケーション
# UIDPの基本的な機能（状態、レイアウト、アクション、条件分岐）を示す
# ============================================================

uidp: "0.2"

meta:
  name: シンプルToDo
  description: タスクの追加・完了・削除ができるシンプルなToDoアプリ
  version: "1.0.0"

# ============================================================
# 型定義
# ============================================================
types:
  Todo:
    id: string
    text: string
    completed: boolean
    createdAt: datetime

# ============================================================
# 画面定義
# ============================================================
screens:
  TodoList:
    title: やることリスト
    description: |
      シンプルなToDoリスト画面
      - 新しいタスクを追加
      - タスクの完了/未完了を切り替え
      - タスクを削除
      - 完了済みタスクを一括削除

    route: /todos

    state:
      # ToDoリスト（ローカルストレージに永続化）
      todos:
        type: Todo[]
        initial: []
        persist: localStorage

      # 新規タスク入力用
      newTodoText:
        type: string
        initial: ""

    computed:
      # 残りタスク数
      remainingCount:
        type: number
        expr: $todos.filter(t => !t.completed).length

      # 完了済みタスクがあるか
      hasCompleted:
        type: boolean
        expr: $todos.some(t => t.completed)

      # リストが空か
      isEmpty:
        type: boolean
        expr: $todos.length == 0

    layout:
      - Card:
          maxWidth: 480px
          margin: auto
          padding: $tokens.spacing.lg
          children:
            # ヘッダー
            - Text:
                variant: h1
                content: やることリスト
                align: center

            # 入力エリア
            - Stack:
                direction: horizontal
                gap: $tokens.spacing.sm
                children:
                  - TextField:
                      value: $newTodoText
                      placeholder: 新しいタスクを入力...
                      flex: 1
                      on:change:
                        set: { newTodoText: $value }
                      on:keydown:
                        - when: $event.key == "Enter" && $newTodoText.trim() != ""
                          then: actions.addTodo

                  - Button:
                      label: 追加
                      variant: primary
                      disabled: $newTodoText.trim() == ""
                      on:click: actions.addTodo

            - Spacer:
                height: $tokens.spacing.md

            # ToDoリスト
            - switch:
                value: $isEmpty
                cases:
                  # 空の場合
                  - case: true
                    then:
                      - Text:
                          content: タスクがありません
                          color: $tokens.colors.text.secondary
                          align: center

                  # タスクがある場合
                  - case: false
                    then:
                      - Stack:
                          direction: vertical
                          gap: $tokens.spacing.xs
                          children:
                            - each: $todos
                              as: todo
                              key: $todo.id
                              render:
                                - Stack:
                                    direction: horizontal
                                    align: center
                                    gap: $tokens.spacing.sm
                                    children:
                                      # 完了チェックボックス
                                      - Checkbox:
                                          checked: $todo.completed
                                          on:change: actions.toggleTodo($todo.id)

                                      # タスクテキスト
                                      - Text:
                                          content: $todo.text
                                          flex: 1
                                          style:
                                            - when: $todo.completed
                                              then:
                                                textDecoration: line-through
                                                color: $tokens.colors.text.secondary

                                      # 削除ボタン
                                      - IconButton:
                                          icon: delete
                                          size: small
                                          color: error
                                          on:click: actions.deleteTodo($todo.id)

            - Spacer:
                height: $tokens.spacing.md

            # フッター
            - Stack:
                direction: horizontal
                justify: space-between
                align: center
                children:
                  # 残りタスク数
                  - Text:
                      content: "残り ${$remainingCount} 件"
                      variant: caption
                      color: $tokens.colors.text.secondary

                  # 完了済みを削除
                  - when: $hasCompleted
                    then:
                      - Button:
                          label: 完了済みを削除
                          variant: text
                          size: small
                          on:click: actions.clearCompleted

    actions:
      # タスクを追加
      addTodo:
        steps:
          - set:
              todos:
                - id: uuid()
                  text: $newTodoText.trim()
                  completed: false
                  createdAt: now()
                - ...$todos
          - set: { newTodoText: "" }

      # タスクの完了状態を切り替え
      toggleTodo:
        params:
          id: string
        steps:
          - set:
              todos: $todos.map(t =>
                t.id == $id
                  ? { ...t, completed: !t.completed }
                  : t
              )

      # タスクを削除
      deleteTodo:
        params:
          id: string
        steps:
          - set:
              todos: $todos.filter(t => t.id != $id)

      # 完了済みタスクを一括削除
      clearCompleted:
        steps:
          - set:
              todos: $todos.filter(t => !t.completed)
