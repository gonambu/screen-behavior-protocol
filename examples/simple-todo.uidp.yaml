uidp: "0.3.0"

meta:
  name: シンプルToDo
  description: タスクの追加・完了・削除ができるToDoアプリ（1画面版）
  version: "1.0.0"

types:
  Todo:
    id: string
    text: string
    completed: boolean
    createdAt: datetime

screens:
  TodoList:
    title: やることリスト

    route: /todos

    state:
      todos:
        type: Todo[]
        initial: []
        persist: localStorage

      newTodoText:
        type: string
        initial: ""

    computed:
      remainingCount:
        count: todos
        where: not completed

      hasCompleted:
        any: todos
        where: completed

      isEmpty:
        empty: todos

    layout:
      - Card:
          maxWidth: 480px
          margin: auto
          padding: tokens.spacing.lg
          children:
            - Text:
                variant: h1
                content: "やることリスト"
                align: center

            - Stack:
                direction: horizontal
                gap: tokens.spacing.sm
                children:
                  - TextField:
                      value: newTodoText
                      placeholder: "新しいタスクを入力..."
                      flex: 1
                      on:change: set(newTodoText, value)
                      on:keydown:
                        - when: event.key equals "Enter" and newTodoText is not empty
                          do: actions.addTodo

                  - Button:
                      label: "追加"
                      variant: primary
                      disabled: newTodoText is empty
                      on:click: actions.addTodo

            - Spacer:
                height: tokens.spacing.md

            - when: isEmpty
              show:
                - Text:
                    content: "タスクがありません"
                    color: tokens.colors.text.secondary
                    align: center
              else:
                - Stack:
                    direction: vertical
                    gap: tokens.spacing.xs
                    children:
                      - each: todos
                        as: todo
                        key: todo.id
                        render:
                          - Stack:
                              direction: horizontal
                              align: center
                              gap: tokens.spacing.sm
                              children:
                                - Checkbox:
                                    checked: todo.completed
                                    on:change:
                                      bubble: false
                                      action: actions.toggleTodo(todo.id)

                                - Text:
                                    content: todo.text
                                    disabled: todo.completed
                                    flex: 1

                                - IconButton:
                                    icon: delete
                                    size: small
                                    color: error
                                    on:click:
                                      bubble: false
                                      action: actions.deleteTodo(todo.id)

            - Spacer:
                height: tokens.spacing.md

            - Stack:
                direction: horizontal
                justify: space-between
                align: center
                children:
                  - Text:
                      content: "残り {remainingCount} 件"
                      variant: caption
                      color: tokens.colors.text.secondary

                  - when: hasCompleted
                    show:
                      - Button:
                          label: "完了済みを削除"
                          variant: text
                          size: small
                          on:click: actions.clearCompleted

    actions:
      addTodo:
        steps:
          - add: todos
            at: start
            item:
              id: uuid()
              text: newTodoText.trim
              completed: false
              createdAt: now()
          - set: newTodoText to ""

      toggleTodo:
        params:
          id: string
        steps:
          - update: todos
            find: id equals {id}
            set:
              completed: toggle

      deleteTodo:
        params:
          id: string
        steps:
          - remove: todos
            where: id equals {id}

      clearCompleted:
        steps:
          - remove: todos
            where: completed
